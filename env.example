# === NextAuth desktop (Electron): минимум для стабильного логина ===
# NEXTAUTH_URL=http://localhost:3001
# NEXTAUTH_SECRET=<openssl rand -base64 32>
# AUTH_ADMIN_EMAIL=admin@local
# AUTH_ADMIN_PASSWORD=...
# Скопируй в .env.local (dev) или в конфиг packaged build.
#
# Postgres (Cloud + multi-user). Когда задан — NextAuth использует Prisma (User/Role в Postgres).
# Рекомендация: Вариант A — один прямой DATABASE_URL (без Accelerate), audit-friendly.
#
# Локально: docker compose up -d postgres → см. docs/ops/POSTGRES_LOCAL.md
# Прямое подключение (НЕ prisma+postgres proxy):
# host (npm на машине):
# DATABASE_URL=postgresql://postgres:postgres@localhost:5432/papa?schema=public
# docker (node/prisma в контейнере — имя сервиса вместо localhost):
# DATABASE_URL=postgresql://postgres:postgres@postgres:5432/papa?schema=public
# Облако (AWS RDS / GCP Cloud SQL / Azure PG): обязательно sslmode=require:
# DATABASE_URL=postgresql://USER:PASSWORD@HOST:5432/DBNAME?schema=public&sslmode=require
#
# Миграции и seed (один и тот же URL):
#   npx prisma migrate dev -n init_auth_rbac_audit
#   SEED_ADMIN_EMAIL=admin@company.com SEED_ADMIN_PASSWORD='...' npx prisma db seed
#
# Вариант B (опционально): DIRECT_DATABASE_URL для migrate, DATABASE_URL для runtime/Accelerate — настраивается отдельно в prisma.config.

# NextAuth — обязательно для стабильного логина (в т.ч. desktop / Electron)
NEXTAUTH_SECRET=generate-with-openssl-rand-base64-32
NEXTAUTH_URL=http://localhost:3001
# ALLOW_DEV_FALLBACK_SECRET=1  # только для локальной отладки без .env.local
# Dev admin (Credentials): логин без БД для portal demo / desktop
AUTH_ADMIN_EMAIL=admin@local
AUTH_ADMIN_PASSWORD=admin
# SKIP_AUTH_FOR_ROOT=1  # debug 500: / → /dev-home (dashboard без auth)

# Первый пользователь создаётся через: npm run seed:admin

# Workspace (обязательно в production). Для пилота — явный путь.
# Пример (база в защищённом месте, не на Desktop):
# WORKSPACE_ROOT=/Users/you/Documents/papa-data/papa-app/data
WORKSPACE_ROOT=/path/to/your/data

# AI Agent: источники документов для индексации
# Postgres+pgvector (при DATABASE_URL): семантический поиск
# SQLite FTS5 (без DATABASE_URL): полнотекстовый поиск
#
# Каноничная схема (рекомендуется). Путь к menasa внутри проекта:
# PAPA_DB_ROOT=/Users/you/Documents/papa-data/papa-app/БАЗА/menasa
# PAPA_DOC_SOURCES=руководства,документы
# PAPA_PRODUCTS=ТВ3-117,АИ-9,НР-3,КД
#
# Legacy (одна папка, обход целиком):
# DOCS_ROOT_DIR=/path/to/folder
DOCS_ROOT_DIR=
PAPA_DB_ROOT=
PAPA_DOC_SOURCES=руководства,документы
PAPA_PRODUCTS=

# Agent: корень для записи артефактов (DOCX, EvidenceMap, sha256)
# AGENT_OUTPUT_ROOT=.../БАЗА/menasa/выгрузки
AGENT_OUTPUT_ROOT=
AGENT_ALLOWED_PRODUCTS=ТВ3-117,АИ-9,НР-3,КД,ARMACK,общие
AGENT_ALLOWED_KINDS=docx,evidencemap,hashes,evidence_kit,эталоны,черновики,логи
# ALLOW_ETALONS_WRITE=1  # разрешить запись в kind=эталоны (по умолчанию 403)

# MRO: библиотека регуляторики (ICAO/EASA/FAA)
# MRO_LIBRARY_ROOT=.../БАЗА/menasa/руководства/регуляторика/MRO
MRO_LIBRARY_ROOT=

# AI Agent: версия для audit meta (git commit). CI: AGENT_VERSION=$(git rev-parse --short HEAD)
# AGENT_VERSION=abc1234

# AI Agent: провайдер эмбеддингов (openai|ollama|stub). stub = fallback при ошибке
# AGENT_EMBEDDINGS_PROVIDER=openai

# OpenAI embeddings (для pgvector, семантический поиск)
# OPENAI_API_KEY=sk-...

# Ollama (оффлайн/air-gapped). Модель nomic-embed-text
# OLLAMA_BASE_URL=http://localhost:11434

# Evidence ledger (optional — S3/GCS bucket for ledger-entry.json)
# LEDGER_BUCKET=my-audit-ledger-bucket
# AWS_REGION=us-east-1  # for CI publish

# Issue ack server (optional — server-side acknowledgements for anchoring issues)
# ACK_SERVER_URL=http://localhost:8787
# ACK_API_KEY=optional-shared-secret

# Auditor portal API (optional — read-only portal over S3 ledger/rollups)
# LEDGER_BUCKET=your-ledger-bucket  # required for portal
# LEDGER_PREFIX=ledger
# DOC_LEDGER_PREFIX=doc-ledger   # doc_update + config_change (allowlist); included in daily rollup Merkle root
# DOC_LEDGER_PENDING_PREFIX=doc-ledger/_pending   # optional; default ${DOC_LEDGER_PREFIX}/_pending
# REQUIRE_CONFIG_LEDGER=1        # if 1/true/yes: POST allowlist fails when doc-ledger write fails (audit trail hard requirement)
# PENDING_GC_OLDER_THAN_HOURS=24  # for ledger:pending:gc (stale _pending cleanup)
# PENDING_GC_MAX_DELETE=1000      # safety: max objects to delete per run
# PENDING_GC_MAX_BYTES=262144000   # safety: max total bytes to delete per run (250MB)
# PENDING_GC_REQUIRE_CONFIRM=1     # require CONFIRM=DELETE or --confirm DELETE
# Health alert (scripts/health-alert.mjs + workflow)
# HEALTH_ALERT_ENABLED=1   # repo var to enable workflow
# ALERT_ROLLUP_MAX_AGE_HOURS=24   # alert if no rollup in N hours
# ALERT_PENDING_THRESHOLD=10     # alert if pending count > N
# SLACK_WEBHOOK_URL=...   # for --slack (optional)
# MAIL_LEDGER_PREFIX=mail-ledger   # included in daily rollup Merkle root
# MAIL_DECISIONS_PREFIX=mail-decisions  # operator decision records (Portal API)
# LEDGER_ROLLUP_PREFIX=ledger-rollups
# PORTAL_AUTH_MODE=none|api_key|oidc
# PORTAL_API_KEY=...  # when api_key mode
# PORTAL_WRITE_API_KEY=...  # for docs propose/approve (MVP: can equal PORTAL_API_KEY)
# PORTAL_OIDC_JWKS_URL=... PORTAL_OIDC_ISSUER=... PORTAL_OIDC_AUDIENCE=...  # when oidc mode
# ACK_SERVER_URL=... ACK_API_KEY=...  # optional ack proxy
# PORT=8790

# Document Store (Portal storage — docs-store, mail-proposals, mail-events)
# DOCS_BUCKET=my-docs
# DOCS_PREFIX=docs-store
# DOCS_PROPOSALS_PREFIX=mail-proposals
# MAIL_EVENTS_PREFIX=mail-events
# MAIL_LEDGER_PREFIX=mail-ledger

# Main app: proxy to Portal API for docs (optional)
# PORTAL_API_URL=http://localhost:8790
# PORTAL_API_KEY=...

# Mail collector (Gmail + IMAP)
# MAIL_GMAIL_ENABLED=1
# MAIL_GMAIL_PROJECT_ID=... MAIL_GMAIL_CLIENT_EMAIL=... MAIL_GMAIL_PRIVATE_KEY=...
# MAIL_GMAIL_IMPERSONATE=user@domain  # Workspace domain-wide delegation
# MAIL_GMAIL_LABELS=Migration/Inbound,Finance,Mura
# MAIL_IMAP_ENABLED=1
# MAIL_IMAP_HOST=mail.nic.ru
# MAIL_IMAP_PORT=993
# MAIL_IMAP_USER=info@2rh.org
# MAIL_IMAP_PASSWORD=...
# MAIL_IMAP_FOLDERS=INBOX
# Inbox allowlist: config/inbox-sources.json (mak.ru, klimov.ru, ao-star.ru)
# MAIL_EVENTS_BUCKET=...  # or MAIL_BUCKET / DOCS_BUCKET
# LEDGER_BACKEND=s3|gcs

# Mail allowlist (M2): env override
# MAIL_ALLOWED_FROM=pay@bank.ru,billing@vendor.com
# MAIL_ALLOWED_FROM_REGEX=@(bank\.ru|vendor\.com)$
# MAIL_ALLOWED_FROM_MODE=deny_all   # deny_all | allow_all

# Mail allowlist from docs-store (M2.1); collector reads this if env not set
# MAIL_ALLOWLIST_DOC_ID=config/mail-allowlist

# Mail triage: auto-analyze only for TRUSTED (DMARC pass). Override for testing:
# MAIL_AUTO_ANALYZE_UNTRUSTED=1
