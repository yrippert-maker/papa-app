# Спринты этапа P1

**Цель:** разбить BACKLOG_P1 на 1–2 спринта с контрольными точками.  
**Правила:** [P1_RULES.md](P1_RULES.md) | **Демо-сценарии:** [DEMO_SCENARIOS_M1_M3.md](DEMO_SCENARIOS_M1_M3.md)

---

## Спринт 1: Каркас RBAC и аутентификация (M1 + M2)

**Длительность:** 1–2 недели  
**Цель:** Policy layer работает, логин через users table.

| US | Описание | Часы |
|----|----------|------|
| US-1 | Таблица users, миграции, сид ролей | 4–6 |
| US-2 | Policy слой lib/authz | 4–6 |
| US-3 | RBAC на API, e2e 403 | 4–6 |
| US-4 | Credentials из users table | 6–8 |
| **Итого** | | **18–26** |

### Milestones внутри спринта

| # | Milestone | Когда |
|---|-----------|-------|
| M1 | Policy layer + 401/403 на API | После US-2, US-3 |
| M2 | Логин через users (не env) | После US-4 |

### Definition of Done спринта 1

- [ ] US-1 … US-4 закрыты по acceptance criteria
- [ ] e2e-smoke расширен: 403 для роли без прав
- [ ] Нет AUTH_USER/AUTH_PASSWORD в authorize()
- [ ] Миграции up/down проверены

---

## Спринт 2: Управление пользователями и нагрузка (M3)

**Длительность:** 1–2 недели  
**Цель:** Admin UI, пагинация, стабильность SQLite.

| US | Описание | Часы |
|----|----------|------|
| US-5 | Admin UI Users | 8–12 |
| US-7 | Пагинация API | 6–8 |
| US-8 | SQLite safe mode | 4–6 |
| **Итого** | | **18–26** |

### Milestone внутри спринта

| # | Milestone | Когда |
|---|-----------|-------|
| M3 | e2e проходит для разных ролей | После US-5 |

### Definition of Done спринта 2

- [ ] US-5, US-7, US-8 закрыты
- [ ] e2e: минимум 2 роли (admin, user/engineer)
- [ ] Пагинация на ключевых страницах
- [ ] Нет долгих write-транзакций

---

## Альтернатива: один длинный спринт

Если спринты 1–2 недели — объединить в один 2–3 недельный:

- Неделя 1: US-1, US-2, US-3 (M1)
- Неделя 2: US-4 (M2), начало US-5
- Неделя 3: US-5, US-7, US-8 (M3)

**Риск:** меньше промежуточных checkpoint’ов.

---

## Рекомендация

**Два спринта** — предпочтительно:
- M1 после спринта 1 — жёсткий gate;
- можно выпустить «логин по users + RBAC» до Admin UI;
- проще планировать review и приёмку.
