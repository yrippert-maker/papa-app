# Матрица ответственности

**Версия:** 1.0  
**Дата:** 2026-02-01  
**Связь:** [MASTER_TZ_AI_CERTIFICATION_v1.0.md](MASTER_TZ_AI_CERTIFICATION_v1.0.md) — раздел «Контуры сертификации»

---

## 1. Разделение: система / человек

| Действие | Система | Человек | Примечание |
|----------|---------|---------|------------|
| Регистрация пользователя | Создаёт запись, назначает роль | **Подтверждает** необходимость и роль | Админ вводит данные; система проверяет права |
| Смена роли пользователя | Применяет изменение | **Подтверждает** новую роль | Журналируется (USER_ROLE_CHANGED) |
| Сброс пароля | Генерирует временный | **Передаёт** пароль пользователю | Пароль не хранится в логах |
| Загрузка файла | Сохраняет, регистрирует, пишет в ledger | **Проверяет** корректность файла | Система — валидация типа/размера |
| Регистрация в ledger | Append-only, hash-chain | — | Система гарантирует целостность |
| Утверждение заявки (approve) | Обновляет статус | **Принимает решение** | Человек нажимает; система проверяет право |
| Выдача ТМЦ | Обновляет остатки | **Подтверждает** выдачу | Физическое действие — ответственность человека |
| AI-анализ (read-only) | Предлагает выводы | **Интерпретирует, принимает решение** | Human-in-the-loop; AI не действует автоматически |

---

## 2. Роли и допустимые действия

| Роль | Действия (разрешено) | Ограничения |
|------|----------------------|-------------|
| **ADMIN** | Полный доступ; управление пользователями; approve; ТМЦ; ledger append; файлы | — |
| **MANAGER** | ТМЦ, заявки, approve, файлы, ledger append | Не может управлять пользователями |
| **STOREKEEPER** | ТМЦ, заявки (без approve), файлы, ledger append | Только операционные действия |
| **ENGINEER** | Просмотр ТМЦ, заявок; файлы (list) | Только чтение по ТМЦ |
| **AUDITOR** | Просмотр workspace, файлов, ledger | Только read; 403 на write/approve/admin |

**Правило:** любое действие выше проверяется через policy layer (`requirePermission`). Ручные проверки прав в endpoint'ах запрещены.

---

## 3. Запреты (система не выполняет)

| # | Запрет | Обоснование |
|---|--------|-------------|
| 1 | Автоматические действия по результатам AI без подтверждения человека | Human-in-the-loop |
| 2 | Прямой доступ AI-агента к БД на запись | AI — read-only; изменения только через API с auth |
| 3 | Изменение или удаление записей ledger | Append-only; неизменяемость для аудита |
| 4 | Выполнение операций без проверки прав | Policy layer обязателен |
| 5 | Логирование паролей, токенов, секретов | Безопасность |
| 6 | Self-demote (смена собственной роли) | Защита от потери доступа |
| 7 | Загрузка исполняемых файлов (.exe, .sh, .bat и т.п.) | Защита от вредоносного кода |

---

## 4. Юридическая ответственность

| Субъект | Ответственность |
|---------|-----------------|
| **Оператор (организация)** | За корректность данных, назначение ролей, соблюдение процедур. За решения, принятые на основе выводов системы. |
| **Пользователь** | За действия, совершённые под своей учётной записью. За передачу учётных данных третьим лицам. |
| **Система (поставщик)** | За функционирование в соответствии с документацией. За целостность ledger и аудит. Не отвечает за содержательные решения пользователей. |
| **AI-агент** | Не является субъектом ответственности. Вся ответственность — у оператора и пользователя. |

**Принцип:** система — инструмент; решение и ответственность — у человека.

---

## 5. Аудит

| Требование | Реализация |
|------------|------------|
| **Кто сделал** | `actor_id`, `actor_email` в событиях USER_*, ledger |
| **Что сделано** | `event_type`, `payload_json` (без секретов) |
| **Когда** | `created_at` в ledger_events |
| **Неизменяемость** | Hash-chain (prev_hash, block_hash) |
| **Доступ к аудиту** | Только роли с LEDGER.READ и выше; аудитор — read-only |

**События для расследования:**
- USER_CREATED, USER_ROLE_CHANGED, USER_PASSWORD_RESET
- USER_CREATE_DENIED, USER_ROLE_CHANGE_DENIED (отказные операции)
- FILE_REGISTERED

---

## 6. Краткая сводка для регулятора

- **Human-in-the-loop:** AI не выполняет автоматических действий без подтверждения человека.
- **Read-only AI:** агент не пишет в БД напрямую.
- **Аудит:** все значимые действия логируются с привязкой к пользователю; ledger неизменяем.
- **Разделение прав:** роли и permissions; нет обхода policy layer.
- **Ответственность:** оператор и пользователь; система — инструмент.
