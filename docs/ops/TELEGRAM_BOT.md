# Telegram-–±–æ—Ç ‚Äî —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏—è–º

## –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–æ–ª–∏ (–∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏):
- **ADMIN** ‚Äî —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è, –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∞–ª–µ—Ä—Ç—ã
- **MANAGER** ‚Äî –æ–¥–æ–±—Ä–µ–Ω–∏—è, –∑–∞–¥–∞—á–∏, —Å–≤–æ–¥–∫–∏
- **ENGINEER** ‚Äî –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏, —Å—Ä–æ–∫–∏
- **AUDITOR** ‚Äî –æ—Ç—á—ë—Ç—ã, findings
- **STOREKEEPER** ‚Äî –∑–∞—è–≤–∫–∏ –¢–ú–¶, –æ—Å—Ç–∞—Ç–∫–∏

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –°–æ–∑–¥–∞—Ç—å –±–æ—Ç–∞

1. –û—Ç–∫—Ä—ã—Ç—å [@BotFather](https://t.me/BotFather)
2. `/newbot` ‚Üí –∏–º—è ‚Üí username
3. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–∫–µ–Ω

### 2. –ü–æ–ª—É—á–∏—Ç—å chat_id

- –î–ª—è –ª–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π: –Ω–∞–ø–∏—Å–∞—Ç—å –±–æ—Ç—É `/start`, –∑–∞—Ç–µ–º [@userinfobot](https://t.me/userinfobot) –ø–æ–∫–∞–∂–µ—Ç `Id`
- –î–ª—è –≥—Ä—É–ø–ø—ã: –¥–æ–±–∞–≤–∏—Ç—å –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø—É, –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ, –≤—ã–∑–≤–∞—Ç—å `getUpdates`:
  ```bash
  curl "https://api.telegram.org/bot<TOKEN>/getUpdates"
  ```

### 3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env):**
```bash
TELEGRAM_BOT_TOKEN=123456789:ABCdefGHI...
```

**–§–∞–π–ª config/telegram-competencies.json:**
```json
{
  "roleChatIds": {
    "ADMIN": "-1001234567890",
    "MANAGER": "-1001234567891",
    "ENGINEER": "123456789"
  },
  "alertChatId": "-1001234567890"
}
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞

```bash
# –í Node REPL –∏–ª–∏ —Å–∫—Ä–∏–ø—Ç–µ
const { notifyByRole } = require('./lib/telegram-notify');
await notifyByRole('ADMIN', '–¢–µ—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ü–ê–ü–ê');
```

## API

- `notifyByRole(role, message, options?)` ‚Äî –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ —á–∞—Ç—ã —Ä–æ–ª–∏
- `notifyByRole('all', message)` ‚Äî –≤–æ –≤—Å–µ —á–∞—Ç—ã + alertChatId
- `sendTelegram(chatId, text, options?)` ‚Äî –Ω–∞–ø—Ä—è–º—É—é –≤ —á–∞—Ç
- `options.inlineButtons` ‚Äî –º–∞—Å—Å–∏–≤ –∫–Ω–æ–ø–æ–∫ (FR-7.4), –Ω–∞–ø—Ä. `[[{ text: 'OK', callback_data: 'ack:1' }]]`

## Webhook (FR-7.4‚Äì7.6)

1. –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å HTTPS
2. –í BotFather: `/setwebhook` ‚Üí `https://<domain>/api/telegram/webhook`
3. –ë–æ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç: `/start`, `/help`, –Ω–∞–∂–∞—Ç–∏—è inline-–∫–Ω–æ–ø–æ–∫ (callback_query)
4. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (FR-7.6): /bind <–∫–æ–¥> ‚Äî –ø—Ä–∏–≤—è–∑–∫–∞ Telegram ID –∫ –∞–∫–∫–∞—É–Ω—Ç—É. –ö–æ–¥ –ø–æ–ª—É—á–∞—é—Ç –≤ /settings/telegram

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ

```typescript
import { notifyByRole } from '@/lib/telegram-notify';

// –ü—Ä–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–∏ compliance
await notifyByRole('MANAGER', `–û–¥–æ–±—Ä–µ–Ω–æ: ${proposalId}`);

// –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –∞–ª–µ—Ä—Ç
await notifyByRole('all', `CRITICAL: ${reason}`, { prefix: 'üö®' });
```

## Cron / —Å–∫—Ä–∏–ø—Ç—ã

–î–ª—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (—Å—Ä–æ–∫–∏, –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è) ‚Äî —Å–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –∏ –¥–æ–±–∞–≤–∏—Ç—å –≤ cron:

```bash
# –ï–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 9:00 ‚Äî –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø–æ —Å—Ä–æ–∫–∞–º
0 9 * * * cd /path/to/papa-app && node scripts/telegram-reminders.mjs
```
