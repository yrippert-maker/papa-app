# Desktop Smoke Test (vX.Y.Z)

Проверка готового desktop-релиза **перед публикацией**. ~5–7 минут.

---

## 1) Установка и первый запуск

- [ ] Установить `.dmg` (macOS) / `.exe` (Windows).
- [ ] Приложение запускается без ошибок, окно открывается.
- [ ] Нет диалогов «повреждённое приложение» / crash на старте.

---

## 2) Первый старт и config.env

- [ ] После первого запуска создан файл:
  - **macOS:** `~/Library/Application Support/ПАПА/config.env`
  - **Windows:** `%AppData%\ПАПА\config.env`
- [ ] В файле есть шаблонные переменные (`NEXTAUTH_SECRET`, `AUTH_ADMIN_*`, флаги health).

---

## 3) Логин

- [ ] Задать `AUTH_ADMIN_EMAIL` / `AUTH_ADMIN_PASSWORD` в `config.env`.
- [ ] Перезапустить приложение.
- [ ] Зайти под admin — логин успешен.
- [ ] После логина открывается главная страница (`/`), не `/login`.

---

## 4) Базовая навигация

- [ ] Открываются основные разделы: Documents / Operations / Compliance (или эквиваленты).
- [ ] Нет белых экранов / 500 / бесконечных спиннеров.
- [ ] Консоль Electron/DevTools без критических ошибок.

---

## 5) Health (ожидаемое поведение)

При `S3_HEALTH_ENABLED=0` и `GCS_HEALTH_ENABLED=0`:

- [ ] `GET /api/system/health` → **200**, `status: "degraded"`.
- [ ] Нет ошибок в UI из-за health.
- [ ] `/api/system/health/s3` и `/api/system/health/gcs` **не используются** в desktop.

---

## 6) Настройки (UX config.env)

- [ ] Страница `/system/settings` доступна **только в desktop**.
- [ ] Изменение `config.env` через UI сохраняется.
- [ ] Кнопка «Перезапустить приложение»:
  - приложение закрывается
  - запускается снова
  - новые env применены (логин / флаги работают).

---

## 7) Auto-update (минимальная проверка)

- [ ] Приложение **не падает** при старте (autoUpdater активен).
- [ ] В логах нет ошибок updater'а.
- [ ] После релиза `vX.Y.Z+1` приложение **предлагает обновление** (можно проверить позже).

---

## Критерий «релиз можно публиковать»

- Установка и старт — ок
- Логин работает
- `.next/cache` не попал в билд (CI уже гарантирует)
- Health ожидаемо `degraded`, без ошибок
- Config.env управляем и безопасен
- Auto-update не ломает запуск

---

## Hotfix Smoke Test (2–3 минуты)

Для патч-релизов достаточно:

1. **Установка и старт** — установить новый билд, приложение запускается без ошибок.
2. **Логин** — зайти под admin, открывается главная страница.
3. **Auto-update** — приложение не падает при старте, в логах нет ошибок updater'а.
