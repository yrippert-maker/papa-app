# AI Agent v1.2 — Quality & Trust (продуктовый roadmap)

**Цель:** усилить результат для регуляторов. Не «доделать платформу», а ускорить пилот / продажу / внедрение.

**Критерий любой работы:** «Как это ускорит пилот / продажу / внедрение?»

---

## Фокус v1.2

| # | Направление | Ценность для регулятора | ROI |
|---|-------------|-------------------------|-----|
| 1 | **Confidence score по источникам** | «Насколько можно доверять этому источнику?» — явная метрика вместо «чёрного ящика» | Пилот: аудитор видит обоснование силы доказательства |
| 2 | **Auto-suggest missing_fields** | Меньше ручного ввода, меньше ошибок, быстрее формирование | Продажа: демо «заполняет само» — wow-эффект |
| 3 | **Шаблоны под регулятора** (EASA / ARMAC) | Документ в формате, который регулятор ожидает | Внедрение: меньше доработок при приёмке |

---

## 1. Confidence score по источникам

### Что

Для каждого evidence-источника — числовая оценка «насколько этот фрагмент релевантен запросу».

### Как

| Компонент | Реализация |
|-----------|------------|
| **Backend** | В `search` API добавить `confidence` (0–1) на каждый chunk. Источники: cosine similarity (уже есть score) или LLM-based relevance. |
| **audit_meta** | `sources[].confidence` — фиксация в audit trail. Регулятор видит: «источник X — 0.92, источник Y — 0.71». |
| **UI** | EvidenceMap: индикатор (цвет/иконка) по уровню confidence. Tooltip: «Высокая релевантность» / «Средняя» / «Низкая». |

### Критерий готовности

Аудитор может ответить на вопрос: «Почему вы использовали этот документ?» — «Потому что confidence 0.9, это самый релевантный фрагмент».

### ~~Реализация~~ ✅ Сделано (v1.2 P0)

- Search API: `confidence` (0–1) на каждый результат (pgvector + SQLite FTS5)
- Draft API: `docScores` → `evidence[].confidence`, сохраняется в БД
- audit_meta: `sources[].confidence` в regulatory bundle
- UI: EvidenceMap — индикатор % (цвет: зелёный ≥80%, жёлтый ≥50%, серый <50%)
- UI: Список результатов поиска — badge с % релевантности

---

## 2. Auto-suggest missing_fields

### Что

При формировании черновика — автоматические подсказки для `missing_fields` на основе содержимого выбранных документов.

### Как

| Компонент | Реализация |
|-----------|------------|
| **Backend** | В `draft` API: для каждого `missing_field` вызвать извлечение из chunks (LLM или rule-based). Например: `serial_number` → искать паттерн S/N, P/N в тексте. |
| **UI** | Поле `missing` показывать с placeholder-подсказкой: «Возможно: S/N 12345 (из doc.pdf)». Кнопка «Применить» рядом. |
| **Аудит** | `audit_meta.suggestions_applied[]` — какие подсказки пользователь принял/отклонил. Прозрачность: «система предложила, человек подтвердил». |

### Критерий готовности

Для типичного акта (3–5 missing fields) — хотя бы 1–2 поля заполняются автоматически с одной кнопкой. Время формирования сокращается.

### ~~Реализация~~ ✅ Сделано (v1.2 P1)

- Rule-based extraction: serial_number (S/N, P/N), act_number (акт №), inspector, approver, operation
- Draft API: извлекает из chunks выбранных документов, auto-fill в draftFields
- missingFields: `suggestion` — подсказка из документа
- UI: placeholder «Найдено: …», label «(подсказка из документа)»

---

## 3. Шаблоны под регулятора (EASA / ARMAC)

### Что

Варианты шаблонов act/techcard, адаптированные под требования конкретного регулятора.

### Как

| Регулятор | Формат | Ключевые отличия |
|-----------|--------|-------------------|
| **EASA** | Part-145, Part-M | Нумерация AMC/GM, ссылки на Part-145.A.50, формат подписи |
| **ARMAC** | Авиационные правила РФ | ГОСТ, ОСТ, нумерация по 285-приказу |

| Компонент | Реализация |
|-----------|------------|
| **Шаблоны** | `act-easa.docx`, `act-armac.docx` — клоны act.docx с другими полями/структурой. |
| **templateKey** | Расширить: `act`, `act-easa`, `act-armac`. Или `act` + `regulator: 'easa'` в draftFields. |
| **requirement_ref** | Справочник REQ-кодов по регулятору. EASA: REQ:EASA-145.*, ARMAC: REQ:ARMAC-* |
| **Документация** | Матрица соответствия: регулятор → шаблон → обязательные поля. |

### Критерий готовности

Пилот с MRO под EASA может сформировать акт в формате, который инспектор ожидает. Меньше доработок при приёмке.

### Оценка

- **Минимум:** 1 шаблон под EASA (act-easa.docx) + матрица полей. ARMAC — как следующий шаг.
- **Расширение:** UI selector «Регулятор: EASA / ARMAC / Общий».

---

## Приоритизация

| Приоритет | Направление | Почему первым |
|-----------|-------------|---------------|
| **P0** | Confidence score | Быстро (нормализация score), сильно для доверия. Регулятор сразу видит «почему этот источник». |
| **P1** | Auto-suggest missing_fields | Wow-эффект на демо. Сокращает время формирования. |
| **P2** | Шаблоны под регулятора | Зависит от пилота. Если пилот — EASA MRO, делать EASA первым. |

---

## Pilot Readiness Pack

**Следующий шаг — не код, а пилот.** См. [PILOT_READINESS_PACK.md](PILOT_READINESS_PACK.md).

- 1 изделие (ТВ3-117), 1 тип документа (акт), 1 регулятор (EASA/ARMAC)
- Demo flow 10–15 мин
- Product one-pager: [PRODUCT_ONE_PAGER.md](PRODUCT_ONE_PAGER.md)

---

## Не в scope v1.2

- Новые типы документов (report, memo) — только если есть конкретный заказчик
- Мультимодальность (изображения, таблицы в PDF) — отдельный трек
- Real-time collaboration — не про регуляторов

---

## Связь с Evidence Kit

v1.2 фичи должны попадать в **audit_meta** и быть верифицируемыми:

- `sources[].confidence` — в regulatory bundle
- `suggestions_applied` — опционально, для прозрачности
- Шаблоны EASA/ARMAC — в PACKAGE_SCHEMA как supported templateKey

Evidence Kit v1.2 — после закрытия P0+P1 (минимум).
